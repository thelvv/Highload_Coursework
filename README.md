# Проектирование сервиса для размещения и просмотра объявлений
Авито — сервис для размещения объявлений о продаже б/у или новых вещей, техники, авто и т.д., их просмотра, также позволяющий покупателю связаться с продавцом для обсуждения товара.

## 1. Тема и целевая аудитория
### Аналоги:
- Юла
- eBay 
- Авто.ру (более узкая автомобильная тематика, но схожая модель)

### MVP
- Размещение объявлений;
- Просмотр объявлений;
- Поиск по объявлениям;
- Чат между покупателем и продавцом.

### Целевая аудитория
На [официальном сайте](https://www.avito.ru/company) Авито указано, что ежемесячная аудитория сервиса более 32 млн человек.

В 2015 году [РБК](https://www.rbc.ru/business/14/12/2015/5669bbdc9a79472e718fd6df) привел следующую статистику:

<img src="/img/RBC_2015_stats.jpg">

Статистика распределения пользователей по странам за январь 2023 года:

| Страна      | Доля пользователей, % |
| ---         | ---                   |
| Россия      | 95.12 	              |
| Украина     | 2.34                  |
| Нидерланды  | 0.34                  |
| Казахстан   | 0.32                  |
| Беларусь    | 0.27                  |
| Другие      | 1.62                  |

*Источник: [SimilarWeb](https://www.similarweb.com/ru/website/avito.ru/#traffic)*

## 2. Расчет нагрузки
### Продуктовые метрики  

Месячная аудитория - __более 32 млн человек__ [*(ист.)*](https://www.avito.ru/company)  
Дневная аудитория - __более 14.7 млн человек__ [*(ист.)*](https://www.avito.ru/b2b-hub/resources/files/Медиакит.pdf)  
Среднее количество просматриваемых страниц за визит - __примерно 11 стр.__ [*(ист.)*](https://www.similarweb.com/ru/website/avito.ru/#overview)  
При приммерно __50 млн активных пользователях__ и более чем __132 млн активных объявлений__ получаем, что среднее число объявлений на пользователя - __3 объявления__ (с округлением в большую сторону).  

Пусть длина объявления 512 символов или 512 байт = __0.5 Кб__; к объявлению можно приложить 10 фото по 1 Мб каждое, то есть __10 Мб на все фото__, также пусть все чаты, связанные с данным объявлением, занимают 2560 байт = __2.5 Кб__. Таким образом можем принебречь текстовыми данными, а одно объявление будет занимать примерно __10 Мб__ хранилища.  
С учетом того, что каждый пользователь имеет в среднем 3 объявления, а также, что он может заполнить информацию о себе (возьмем 2 Мб), то один пользователь будет занимать __32 Мб__ хранилища.  


| Действие                      | Количество в день (на одного пользователя) |
|-------------------------------|--------------------------------------------|
| Размещение объявлений         | 0.008                                      |
| Просмотр и поиск объявлений   | 6                                          |

### Технические метрики
Хранение текстовых данных:  
*3 Кб * 50 млн пользователей * 3 объявления ~ __0.45 Тб__*  

Хранение изображений:  
*10 Мб * 50 млн пользователей * 3 объявления ~ __1500 Тб__*  
| Тип данных          | Размер, Тб |
|---------------------|------------|
| Текстовые данные    | 0.45       |
| Изображения         | 1500       |

Пиковое потребление в течении суток:  
*[2 (коэфф. пиковой нагрузки) * 14.7 млн пользоателей * 11 страниц * 10 Мб (одно объявление)] / 86400 сек (сутки) ~ 36.5 Гбайт/сек = __292.4 Гбит/сек__*

Суммарный суточный трафик (текстовые данные):  
*14.7 млн пользоателей * 11 страниц * 3 Кб (одно объявление) ~ __485 Тб__*  

Суммарный суточный трафик (изображения):  
*14.7 млн пользоателей * 11 страниц * 10 Мб (одно объявление) ~ __1542 Тб__*

| Метрика                                 | Значение       |
|-----------------------------------------|----------------|
| Пиковое потребление в течении суток     | 292.4 Гбит/сек |
| Суммарный суточный трафик (текст)       | 485 Тб         |
| Суммарный суточный трафик (изображения) | 1542 Тб        |

RPS для просмотра объяления:  
*[14.7 млн пользоателей * 5 просмотров] / 86400 сек ~ __850 RPS__*

RPS для поиска объяления:  
*[14.7 млн пользоателей * 5 поисковых запросов] / 86400 сек ~ __850 RPS__*

RPS для размещения объяления:  
*400 тыс. (новых объявлений в день) / 86400 сек ~ __5 RPS__*

RPS для отправки сообщения:  
*[400 тыс. объявлений * 5 чатов * 20 сообщений] / 86400 сек ~ __463 RPS__* 

| Действие               | RPS  |
|------------------------|------|
| Просмотр объяления     | 850  |
| поиск объяления        | 850  |
| Размещения объяления   | 5    |
| Отправка сообщения     | 463  |
| Всего                  | 2168 |
