# Проектирование сервиса для размещения и просмотра объявлений
Авито — сервис для размещения объявлений о продаже б/у или новых вещей, техники, авто и т.д., их просмотра, также позволяющий покупателю связаться с продавцом для обсуждения товара.

## 1. Тема и целевая аудитория
### Аналоги:
- Юла
- eBay 
- Авто.ру (более узкая - автомобильная тематика, но схожая модель)

### MVP
- Размещение объявлений;
- Просмотр объявлений;
- Поиск по объявлениям;
- Регистрация;
- Чат между покупателем и продавцом.

### Целевая аудитория
Ежемесячная аудитория сервиса составляет более 44.7 млн человек.  
*Источник: [Презентация Авито](https://www.avito.ru/b2b-hub/resources/files/%D0%9C%D0%B5%D0%B4%D0%B8%D0%B0%D0%BA%D0%B8%D1%82.pdf)*

Статистика распределения пользователей по странам за январь 2023 года:

| Страна      | Доля пользователей, % |
| ---         | :---:                 |
| Россия      | 95.12 	              |
| Украина     | 2.34                  |
| Нидерланды  | 0.34                  |
| Казахстан   | 0.32                  |
| Беларусь    | 0.27                  |
| Другие      | 1.62                  |

*Источник: [SimilarWeb](https://www.similarweb.com/ru/website/avito.ru/#traffic)*

## 2. Расчет нагрузки
### Продуктовые метрики  

Месячная аудитория - __более 44.7 млн млн человек__ [*(ист.)*](https://www.avito.ru/company)  
Дневная аудитория - __более 14.7 млн человек__ [*(ист.)*](https://www.avito.ru/b2b-hub/resources/files/Медиакит.pdf)  
Среднее количество просматриваемых страниц за визит - __примерно 11 стр.__ [*(ист.)*](https://www.similarweb.com/ru/website/avito.ru/#overview)  
При приммерно __50 млн активных пользователях__ и более чем __140 млн активных объявлений__ [*(ист.)*](https://www.avito.ru/company) получаем, что среднее число объявлений на пользователя - __3 объявления__ (с округлением в большую сторону).  

Пусть длина объявления 1024 символа или 1024 байта = __1 Кб__; к объявлению можно приложить 10 фото по 1 Мб каждое, то есть __10 Мб на все фото__, также пусть все чаты, связанные с данным объявлением, занимают 3072 байт = __3 Кб__. Таким образом можем принебречь текстовыми данными, а одно объявление будет занимать примерно __10 Мб__ хранилища.  
С учетом того, что каждый пользователь имеет в среднем 3 объявления, а также, что он может заполнить информацию о себе (возьмем 2 Мб), то один пользователь будет занимать __32 Мб__ хранилища.  


| Действие                      | Количество в день (на одного пользователя) |
|-------------------------------|:------------------------------------------:|
| Размещение объявлений         | 0.008                                      |
| Просмотр и поиск объявлений   | 6                                          |

### Технические метрики
Хранение текстовых данных:  
*[4 Кб * 3 объявления + 2 Мб (пользовательские данные)] * 50 млн пользователей ~ __96 Тб__*  

Хранение изображений:  
*10 Мб * 50 млн пользователей * 3 объявления ~ __1500 Тб__*  

| Тип данных          | Размер, Тб |
|---------------------|:----------:|
| Текстовые данные    | 96         |
| Изображения         | 1500       |

Пиковое потребление в течении суток:  
*[2 (коэфф. пиковой нагрузки) * 1.5 (коэфф. пиковой нагрузки в течение суток) * 14.7 млн пользоателей * 11 страниц * 10 Мб (одно объявление)] / 86400 сек (сутки) ~ 54.8 Гбайт/сек = __438.6 Гбит/сек__*  

Суммарный суточный трафик (текстовые данные):  
*14.7 млн пользоателей * 11 страниц * 3 Кб (одно объявление) ~ 468.6 Гб ~ __0.47 Тб__*  

Суммарный суточный трафик (изображения):  
*14.7 млн пользоателей * 11 страниц * 10 Мб (одно объявление) ~ __1542 Тб__*

| Метрика                                 | Значение       |
|-----------------------------------------|----------------|
| Пиковое потребление в течении суток     | 438.6 Гбит/сек |
| Суммарный суточный трафик (текст)       | 0.47 Тб        |
| Суммарный суточный трафик (изображения) | 1542 Тб        |

RPS для просмотра объяления:  
*[14.7 млн пользоателей * 6 просмотров] / 86400 сек ~ __1020 RPS__*

RPS для поиска объяления:  
*[14.7 млн пользоателей * 6 поисковых запросов] / 86400 сек ~ __1020 RPS__*

RPS для размещения объяления:  
*400 тыс. (новых объявлений в день, [ист.](https://www.avito.ru/company)) / 86400 сек ~ __5 RPS__*

RPS для отправки сообщения:  
*[400 тыс. объявлений * 5 чатов * 20 сообщений] / 86400 сек ~ __463 RPS__* 

RPS для регистрации:  
*7955.4 (пользователей регистрируется за сутки, [ист.](https://www.avito.ru/b2b-hub/resources/files/%D0%9C%D0%B5%D0%B4%D0%B8%D0%B0%D0%BA%D0%B8%D1%82.pdf)) / 86400 сек ~ __0.1 RPS__* 

| Действие               | RPS    | RPS с учетом суточного пика (х1.5) |
|------------------------|:------:|:----------------------------------:|
| Просмотр объяления     | 1020   | 1530                               |
| поиск объяления        | 1020   | 1530                               |
| Размещения объяления   | 5      | 7.5                                |
| Отправка сообщения     | 463    | 694.5                              |
| Регистрация            | 0.1    | 0.15                               |
| Всего                  | 2508.1 | 3762.2                             |
